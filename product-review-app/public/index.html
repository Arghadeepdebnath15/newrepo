<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" href="%PUBLIC_URL%/favicon.ico" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
    <meta name="theme-color" content="#000000" />
    <meta
      name="description"
      content="Product review web application"
    />
    <link rel="apple-touch-icon" href="%PUBLIC_URL%/logo192.png" />
    <!--
      manifest.json provides metadata used when your web app is installed on a
      user's mobile device or desktop. See https://developers.google.com/web/fundamentals/web-app-manifest/
    -->
    <link rel="manifest" href="%PUBLIC_URL%/manifest.json" />
    <!--
      Notice the use of %PUBLIC_URL% in the tags above.
      It will be replaced with the URL of the `public` folder during the build.
      Only files inside the `public` folder can be referenced from the HTML.

      Unlike "/favicon.ico" or "favicon.ico", "%PUBLIC_URL%/favicon.ico" will
      work correctly both with client-side routing and a non-root public URL.
      Learn how to configure a non-root public URL by running `npm run build`.
    -->
    
    <!-- Preconnect to API domain for faster data loading -->
    <link rel="preconnect" href="http://localhost:5000" />
    
    <!-- Preload critical fonts to prevent layout shifts -->
    <link rel="preload" href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;600;700&display=swap" as="style" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;600;700&display=swap" />
    
    <!-- Basic reload fixes that work without script errors -->
    <script>
      // Enable pull-to-refresh on Chrome mobile
      document.documentElement.style.overscrollBehavior = 'contain';
      document.documentElement.style.overscrollBehaviorY = 'contain';
      document.body.style.overscrollBehavior = 'contain';
      document.body.style.overscrollBehaviorY = 'contain';
      
      // Disable all fancy scroll behavior immediately
      document.documentElement.style.scrollBehavior = 'auto';
      document.documentElement.style.scrollSnapType = 'none';
      
      // Force touch scrolling on mobile
      document.documentElement.style.webkitOverflowScrolling = 'touch';
      
      // Simple flag to check if it's loaded by a reload
      var reloadFlag = false;
      
      // For mobile devices
      var isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
      var isChrome = /Chrome/i.test(navigator.userAgent);
      
      if (isMobile) {
        document.documentElement.classList.add('mobile-device');
        // Additional mobile-specific fixes
        document.documentElement.style.height = '100%';
        document.documentElement.style.width = '100%';
        document.body.style.height = '100%';
        document.body.style.width = '100%';
        
        // Special handling for Chrome mobile
        if (isChrome) {
          document.documentElement.classList.add('chrome-mobile');
          // Ensure pull-to-refresh works
          document.documentElement.style.overscrollBehavior = 'contain';
          document.documentElement.style.overscrollBehaviorY = 'contain';
          document.body.style.overscrollBehavior = 'contain';
          document.body.style.overscrollBehaviorY = 'contain';
        }
      }
      
      // Check if this is a reload using multiple methods
      function checkReload() {
        // Method 1: Performance Navigation
        if (performance && performance.navigation) {
          if (performance.navigation.type === 1) {
            return true;
          }
        }
        
        // Method 2: Navigation Entries
        if (window.performance && window.performance.getEntriesByType) {
          const navEntries = window.performance.getEntriesByType('navigation');
          if (navEntries.length > 0 && navEntries[0].type === 'reload') {
            return true;
          }
        }
        
        // Method 3: Session Storage
        if (sessionStorage.getItem('isReloading')) {
          sessionStorage.removeItem('isReloading');
          return true;
        }
        
        return false;
      }
      
      // Set reload flag
      reloadFlag = checkReload();
      if (reloadFlag) {
        document.documentElement.classList.add('is-reload');
      }
      
      // Handle beforeunload to set reload flag
      window.addEventListener('beforeunload', function() {
        sessionStorage.setItem('isReloading', 'true');
        // Force disable smooth scrolling
        document.documentElement.style.scrollBehavior = 'auto';
        document.body.style.scrollBehavior = 'auto';
      });
      
      // Make reload button work on mobile
      window.addEventListener('load', function() {
        if (isMobile) {
          // Force redraw for mobile browsers
          setTimeout(function() {
            document.body.style.display = 'none';
            // Force reflow by reading offsetHeight
            // eslint-disable-next-line no-unused-vars
            const forceReflow = document.body.offsetHeight;
            document.body.style.display = '';
            
            // Additional mobile fixes
            document.documentElement.style.webkitOverflowScrolling = 'touch';
            document.documentElement.style.overscrollBehavior = 'contain';
            document.documentElement.style.overscrollBehaviorY = 'contain';
            
            // Reset any problematic styles
            document.documentElement.style.position = 'static';
            document.body.style.position = 'static';
            document.documentElement.style.overflow = 'auto';
            document.body.style.overflow = 'auto';
          }, 10);
        }
      });
      
      // Handle orientation changes on mobile
      if (isMobile) {
        window.addEventListener('orientationchange', function() {
          // Force redraw after orientation change
          setTimeout(function() {
            document.body.style.display = 'none';
            // Force reflow by reading offsetHeight
            // eslint-disable-next-line no-unused-vars
            const forceReflow = document.body.offsetHeight;
            document.body.style.display = '';
          }, 100);
        });
      }
      
      // Add touch event listeners to help with pull-to-refresh
      if (isMobile && isChrome) {
        let touchStartY = 0;
        let touchEndY = 0;
        
        document.addEventListener('touchstart', function(e) {
          touchStartY = e.touches[0].clientY;
        }, { passive: true });
        
        document.addEventListener('touchend', function(e) {
          touchEndY = e.changedTouches[0].clientY;
          
          // If pulled down more than 100px at the top of the page
          if (window.scrollY === 0 && touchEndY - touchStartY > 100) {
            // Trigger reload
            window.location.reload();
          }
        }, { passive: true });
      }
    </script>
    
    <!-- Prevent FOUC (Flash of Unstyled Content) -->
    <style>
      body {
        margin: 0;
        padding: 0;
        background-color: #f8f9fa;
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      }
      
      .initial-loading {
        display: flex;
        align-items: center;
        justify-content: center;
        flex-direction: column;
        min-height: 100vh;
        color: #333;
      }
      
      /* Reset all fancy CSS for reliability */
      html, body {
        scroll-behavior: auto !important;
        scroll-snap-type: none !important;
        -webkit-overflow-scrolling: auto !important;
      }
      
      /* Mobile devices get even more resets */
      html.mobile-device {
        scroll-behavior: auto !important;
        scroll-snap-type: none !important;
        -webkit-overflow-scrolling: touch !important;
      }
      
      /* Try to enable pull to refresh for all browsers */
      body {
        overscroll-behavior-y: contain;
      }
      
      /* Reload indicator for debugging */
      html.is-reload:after {
        content: '';
        display: none;
      }
    </style>
    
    <title>Product Review App</title>
  </head>
  <body>
    <noscript>You need to enable JavaScript to run this app.</noscript>
    <div id="root">
      <!-- Initial loading state to prevent layout shifts -->
      <div class="initial-loading">
        <h2>Loading application...</h2>
      </div>
    </div>
    <!--
      This HTML file is a template.
      If you open it directly in the browser, you will see an empty page.

      You can add webfonts, meta tags, or analytics to this file.
      The build step will place the bundled scripts into the <body> tag.

      To begin the development, run `npm start` or `yarn start`.
      To create a production bundle, use `npm run build` or `yarn build`.
    -->
  </body>
</html>
