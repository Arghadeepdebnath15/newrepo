<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" href="%PUBLIC_URL%/favicon.ico" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="theme-color" content="#000000" />
    <meta
      name="description"
      content="Product review web application"
    />
    <link rel="apple-touch-icon" href="%PUBLIC_URL%/logo192.png" />
    <!--
      manifest.json provides metadata used when your web app is installed on a
      user's mobile device or desktop. See https://developers.google.com/web/fundamentals/web-app-manifest/
    -->
    <link rel="manifest" href="%PUBLIC_URL%/manifest.json" />
    <!--
      Notice the use of %PUBLIC_URL% in the tags above.
      It will be replaced with the URL of the `public` folder during the build.
      Only files inside the `public` folder can be referenced from the HTML.

      Unlike "/favicon.ico" or "favicon.ico", "%PUBLIC_URL%/favicon.ico" will
      work correctly both with client-side routing and a non-root public URL.
      Learn how to configure a non-root public URL by running `npm run build`.
    -->
    
    <!-- Preconnect to API domain for faster data loading -->
    <link rel="preconnect" href="http://localhost:5000" />
    
    <!-- Preload critical fonts to prevent layout shifts -->
    <link rel="preload" href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;600;700&display=swap" as="style" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;600;700&display=swap" />
    
    <!-- Fix reload issues, with enhanced mobile support -->
    <script>
      // Mobile detection
      var isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
      
      // Apply mobile-specific fixes immediately
      if (isMobile) {
        // Disable scroll behavior on mobile devices to prevent reload issues
        document.documentElement.style.scrollBehavior = 'auto';
        document.documentElement.style.scrollSnapType = 'none';
        
        // Add reload-specific class for mobile
        document.documentElement.classList.add('mobile-device');
      }
      
      // Handle page reload for all devices
      window.addEventListener('beforeunload', function() {
        document.documentElement.classList.add('reloading');
        
        // Store scroll position
        try {
          sessionStorage.setItem('scrollPosition', window.scrollY.toString());
          
          if (isMobile) {
            // Store additional data for mobile devices
            sessionStorage.setItem('isMobileReload', 'true');
            // Force scroll behavior reset for mobile
            document.documentElement.style.scrollBehavior = 'auto';
            document.documentElement.style.scrollSnapType = 'none';
            document.body.style.scrollBehavior = 'auto';
          }
        } catch (e) {
          console.error('Error storing scroll position:', e);
        }
      });
      
      // Special handling for mobile page visibility changes
      if (isMobile) {
        document.addEventListener('visibilitychange', function() {
          if (document.visibilityState === 'visible') {
            // When the page becomes visible again (like after refresh)
            document.documentElement.classList.add('reloading');
            setTimeout(function() {
              document.documentElement.classList.remove('reloading');
            }, 1000);
          }
        });
      }
      
      // Restore scroll position after reload
      document.addEventListener('DOMContentLoaded', function() {
        // Try to determine if this is a reload
        var isMobileReload = sessionStorage.getItem('isMobileReload') === 'true';
        var scrollPosition = sessionStorage.getItem('scrollPosition');
        
        if (scrollPosition) {
          // Clear storage immediately to prevent issues with multiple restores
          sessionStorage.removeItem('scrollPosition');
          sessionStorage.removeItem('isMobileReload');
          
          // Use a small delay to ensure the page is fully loaded before scrolling
          setTimeout(function() {
            window.scrollTo(0, parseInt(scrollPosition));
            
            // For mobile, keep the reloading class a bit longer
            if (isMobile || isMobileReload) {
              setTimeout(function() {
                document.documentElement.classList.remove('reloading');
                // Re-enable smooth scrolling after reload is complete
                if (!isMobile) { // Keep disabled on mobile for better performance
                  document.documentElement.style.scrollBehavior = 'smooth';
                  document.documentElement.style.scrollSnapType = 'y proximity';
                }
              }, 1000);
            } else {
              // For desktop, shorter delay
              setTimeout(function() {
                document.documentElement.classList.remove('reloading');
              }, 500);
            }
          }, isMobile ? 300 : 0);
        } else {
          // If no scroll position (not a reload), just remove the class
          setTimeout(function() {
            document.documentElement.classList.remove('reloading');
          }, 500);
        }
      });
      
      // Add double-tap reload hack for iOS
      if (isMobile) {
        var lastTap = 0;
        document.addEventListener('touchend', function(e) {
          var currentTime = new Date().getTime();
          var tapLength = currentTime - lastTap;
          if (tapLength < 500 && tapLength > 0) {
            // Double tap detected, force reload behavior
            document.documentElement.classList.add('reloading');
            document.documentElement.style.scrollBehavior = 'auto';
            document.documentElement.style.scrollSnapType = 'none';
          }
          lastTap = currentTime;
        });
      }
    </script>
    
    <!-- Prevent FOUC (Flash of Unstyled Content) -->
    <style>
      body {
        margin: 0;
        padding: 0;
        background-color: #f8f9fa;
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      }
      
      .initial-loading {
        display: flex;
        align-items: center;
        justify-content: center;
        flex-direction: column;
        min-height: 100vh;
        color: #333;
      }
      
      /* Fix reload issues */
      html.reloading {
        scroll-behavior: auto !important;
        scroll-snap-type: none !important;
        -webkit-overflow-scrolling: auto !important;
      }
      
      /* Mobile-specific fixes */
      html.mobile-device {
        /* Optimize for mobile */
        scroll-behavior: auto !important;
        scroll-snap-type: none !important;
        -webkit-overflow-scrolling: touch !important;
      }
    </style>
    
    <title>Product Review App</title>
  </head>
  <body>
    <noscript>You need to enable JavaScript to run this app.</noscript>
    <div id="root">
      <!-- Initial loading state to prevent layout shifts -->
      <div class="initial-loading">
        <h2>Loading application...</h2>
      </div>
    </div>
    <!--
      This HTML file is a template.
      If you open it directly in the browser, you will see an empty page.

      You can add webfonts, meta tags, or analytics to this file.
      The build step will place the bundled scripts into the <body> tag.

      To begin the development, run `npm start` or `yarn start`.
      To create a production bundle, use `npm run build` or `yarn build`.
    -->
  </body>
</html>
